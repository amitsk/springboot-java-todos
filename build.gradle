buildscript {
	ext {
		springBootVersion = '2.0.0.RELEASE'
	}
	repositories {
		mavenCentral()
		maven { url "https://repo.spring.io/snapshot" }
		maven { url "https://repo.spring.io/milestone" }
	}
	dependencies {
        classpath 'org.junit.platform:junit-platform-gradle-plugin:1.0.3'
        classpath 'com.kncept.junit5.reporter:junit-reporter:1.0.2'
		classpath("org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}")
	}
}

ext {
    restAssuredVersion = '3.0.6'
    jacksonVersion = '2.9.4'
    junitPlatformVersion = '1.0.3'
    junitJupiterVersion = '5.0.3'
    log4jVersion = '2.10.0'
    resilience4jVersion = '0.12.1'
}

apply plugin: 'java'
apply plugin: 'org.springframework.boot'
apply plugin: 'io.spring.dependency-management'
apply plugin: 'project-report'
apply plugin: 'org.junit.platform.gradle.plugin'
apply plugin: 'com.kncept.junit5.reporter'

group = 'com.github.amitsk'
version = '0.0.1-SNAPSHOT'
sourceCompatibility = 1.8

repositories {
	mavenCentral()
    jcenter()
	maven { url "https://repo.spring.io/snapshot" }
	maven { url "https://repo.spring.io/milestone" }
}


ext {
	springCloudVersion = 'Finchley.M8'
}

dependencies {
	compile('org.springframework.boot:spring-boot-starter-actuator')
	compile('org.springframework.cloud:spring-cloud-starter-sleuth')
	compile('org.springframework.retry:spring-retry')
	compile('org.springframework.boot:spring-boot-starter-web') {
        exclude module: 'tomcat-embed-core'
    }
	compile('org.springframework.boot:spring-boot-starter-webflux')
    compile('io.projectreactor.ipc:reactor-netty')
    compileOnly('org.projectlombok:lombok')
    compile "com.fasterxml.jackson.module:jackson-modules-java8:${jacksonVersion}"
    compile 'com.nike.backstopper:backstopper-core:0.11.4'
    compile 'com.squareup.retrofit2:retrofit:2.4.0'
    compile 'com.squareup.retrofit2:converter-jackson:2.4.0'
    compile "io.github.resilience4j:resilience4j-circuitbreaker:$resilience4jVersion"
    compile "io.github.resilience4j:resilience4j-cache:$resilience4jVersion"
    compile "io.github.resilience4j:resilience4j-reactor:$resilience4jVersion"
    compile 'com.jakewharton.retrofit:retrofit2-reactor-adapter:2.1.0'

    //Start Test deps
	testCompile('org.springframework.boot:spring-boot-starter-test') {
        exclude module: 'junit'
    }
	testCompile('io.projectreactor:reactor-test')
    // JUnit Jupiter API and TestEngine implementation
    testCompile("org.junit.jupiter:junit-jupiter-api:${junitJupiterVersion}")
    testCompile("org.junit.jupiter:junit-jupiter-params:${junitJupiterVersion}")
    testCompile ("io.rest-assured:rest-assured:${restAssuredVersion}")
    testCompile 'org.assertj:assertj-core:3.9.0'
    testCompile 'org.mockito:mockito-core:2.13.0'
    testCompile 'com.squareup.okhttp3:mockwebserver:3.9.1'

    testRuntime("org.junit.jupiter:junit-jupiter-engine:${junitJupiterVersion}")
    // To avoid compiler warnings about @API annotations in JUnit code
    testCompileOnly('org.apiguardian:apiguardian-api:1.0.0')


}

dependencyManagement {
	imports {
		mavenBom "org.springframework.cloud:spring-cloud-dependencies:${springCloudVersion}"
	}
}

junitPlatform {
    filters {
        engines {
            include 'junit-jupiter'
            // exclude 'custom-engine'
        }
        tags {
            // include 'fast'
            exclude 'slow'
        }
        // includeClassNamePattern '.*Test'
    }
    // configurationParameter 'junit.jupiter.conditions.deactivate', '*'
    // enableStandardTestTask true
    // reportsDir file('build/test-results/junit-platform') // this is the default
    //logManager 'org.slf4j.LoggerFactory'
}

junitPlatformTest.finalizedBy 'junitHtmlReport'